generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
}

enum Role {
    SUPER_ADMIN
    ADMIN
    EXPLORER
}

enum TripStatus {
    PLANNED
    COMPLETED
    CANCELLED
}

enum MatchStatus {
    PENDING
    ACCEPTED
    REJECTED
    CANCELLED
    COMPLETED
}

enum UserStatus {
    ACTIVE
    BLOCKED
    SUSPENDED
}

enum PaymentStatus {
    PAID
    UNPAID
    PENDING
    FAILED
}

enum Gender {
    MALE
    FEMALE
}

enum LookingFor {
    MALE
    FEMALE
    ANYONE
}

enum SubscriptionPlan {
    FREE
    STANDARD
    PREMIUM
}

enum ReviewStatus {
    PENDING
    APPROVED
    REJECTED
}

model User {
    id             String     @id @default(uuid())
    email          String     @unique
    password       String
    role           Role       @default(EXPLORER)
    status         UserStatus @default(ACTIVE)
    isDeleted      Boolean    @default(false)
    emailConfirmed Boolean    @default(false)
    createdAt      DateTime   @default(now())
    updatedAt      DateTime   @updatedAt

    admin    Admin?    @relation("UserAdmin")
    explorer Explorer? @relation("UserExplorer")
}

model Admin {
    id             String   @id @default(uuid())
    userId         String   @unique
    fullName       String
    profilePicture String?
    address        String?
    bio            String?  @db.Text
    phone          String
    createdAt      DateTime @default(now())
    updatedAt      DateTime @updatedAt

    user User @relation("UserAdmin", fields: [userId], references: [id])
}

model Explorer {
    id              String        @id @default(uuid())
    userId          String        @unique
    fullName        String
    gender          Gender
    age             String?
    profilePicture  String?
    address         String?
    bio             String?       @db.Text
    phone           String
    travelStyleTags String[]
    interests       String[]
    isPremium       Boolean       @default(false)
    trips           Trip[]
    subscription    Subscription?

    outgoingMatches Match[] @relation("Requester")
    incomingMatches Match[] @relation("Recipient")

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    user     User      @relation("UserExplorer", fields: [userId], references: [id])
    payments Payment[]
    reviews  Review[]
}

model Trip {
    id                String     @id @default(uuid())
    title             String
    image             String?
    creatorId         String
    destination       String
    departureLocation String
    startDate         DateTime
    endDate           DateTime
    description       String?    @db.Text
    budget            String
    journeyType       String[]
    matchCompleted    Boolean    @default(false)
    duration          String
    Languages         String[]
    status            TripStatus @default(PLANNED)
    createdAt         DateTime   @default(now())
    updatedAt         DateTime   @updatedAt

    creator Explorer @relation(fields: [creatorId], references: [id])
    matches Match[]
}

model Match {
    id          String      @id @default(uuid())
    requesterId String
    recipientId String
    tripId      String
    status      MatchStatus @default(PENDING)
    createdAt   DateTime    @default(now())
    updatedAt   DateTime    @updatedAt

    requester Explorer @relation("Requester", fields: [requesterId], references: [id])
    recipient Explorer @relation("Recipient", fields: [recipientId], references: [id])
    trip      Trip     @relation(fields: [tripId], references: [id])
    reviews   Review[]

    @@unique([requesterId, recipientId, tripId])
}

model Subscription {
    id         String           @id @default(uuid())
    explorerId String           @unique
    planName   SubscriptionPlan @default(FREE)
    paymentId  String?          @unique
    startDate  DateTime         @default(now())
    endDate    DateTime
    isActive   Boolean          @default(true)
    createdAt  DateTime         @default(now())
    updatedAt  DateTime         @updatedAt

    explorer Explorer @relation(fields: [explorerId], references: [id])
    payment  Payment? @relation(fields: [paymentId], references: [id])
}

model Payment {
    id            String           @id @default(uuid())
    explorerId    String
    planName      SubscriptionPlan
    amount        Float
    currency      String           @default("BDT")
    gateway       String
    transactionId String?          @unique
    status        PaymentStatus    @default(PENDING)
    rawResponse   Json?
    createdAt     DateTime         @default(now())
    updatedAt     DateTime         @updatedAt

    explorer     Explorer      @relation(fields: [explorerId], references: [id])
    subscription Subscription?
}

model Review {
    id         String       @id @default(uuid())
    matchId    String
    reviewerId String // Explorer who gives the review
    rating     Int
    comment    String?
    status     ReviewStatus @default(PENDING)
    createdAt  DateTime     @default(now())
    updatedAt  DateTime     @updatedAt

    match    Match    @relation(fields: [matchId], references: [id])
    reviewer Explorer @relation(fields: [reviewerId], references: [id])

    @@unique([matchId, reviewerId]) // One review per person per match
}
